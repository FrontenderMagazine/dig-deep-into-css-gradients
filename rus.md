# Погружение в градиенты CSS

Я и представить не могла насколько мощным инструментом являются градиенты CSS до
того как в конце 2011 года обнаружила [галерею паттернов CSS3](http://lea.verou.me/css3patterns/) 
созданную Лией Веру (Lea Verou). Возможность создавать различные фигуры 
используя только градиенты заложила основу для множества моих експериментов с 
CSS.  

![Rainbow wheel](img/rainbow_wheel_screen.gif?raw=true&repo=dig_deep_into_css_gradients "Rainbow wheel")

Недавно просматривая демо на CodePen, я наткнулась на [разноцветное колесо 
построеное на CSS3](http://codepen.io/bitmap/pen/eBbHt) и меня посетила мысль: 
"А ведь для создания такого колеса можно использовать и только один 
обьект и градиенты". Сказано - сделано, результат можно увидеть 
[здесь](http://codepen.io/bitmap/pen/eBbHt). Дальше обьясню как именно это 
делается. 

## Разделение на составляющие

Колесо, которое также можно назвать обычным кругом, сначала разделяем по 
горизонтали на две части и затем каждую половину еще на 5 частей, так что в 
общем получается 20 секторов. [Центральный угол](en.wikipedia.org/wiki/Central_angle) 
каждого сектора составляет [360°](www.mathopenref.com/degrees.html)/10 = 36°.

Демо, размещенное ниже, демонстрирует как разные уровни фона накладываются друг 
на друга. В него добавлена кнопка "Пауза" чтобы избежать проблем с 
производительностью которые могут возникнуть изза повторяющейся анимации.

<iframe id="cp_embed_Kuvom" src="http://codepen.io/thebabydino/embed/Kuvom?type=result&height=340&safe=true" data-height="340" 
allowtransparency="true" class="cp_embed_iframe" style="width: 100%;
border: none; overflow: hidden;" scrolling="no" frameborder="0" height="340">
</iframe>

И в исходном примере, и в дополнительном демо нас интересует эта часть:

	background: 
	linear-gradient(36deg, #272b66 42.34%, transparent 42.34%),
	linear-gradient(72deg, #2d559f 75.48%, transparent 75.48%),
	linear-gradient(-36deg, #9ac147 42.34%, transparent 42.34%) 100% 0,
	linear-gradient(-72deg, #639b47 75.48%, transparent 75.48%) 100% 0, 
	linear-gradient(36deg, transparent 57.66%, #e1e23b 57.66%) 100% 100%,
	linear-gradient(72deg, transparent 24.52%, #f7941e 24.52%) 100% 100%,
	linear-gradient(-36deg, transparent 57.66%, #662a6c 57.66%) 0 100%,
	linear-gradient(-72deg, transparent 24.52%, #9a1d34 24.52%) 0 100%, 
	#43a1cd linear-gradient(#ba3e2e, #ba3e2e) 50% 100%;
	background-repeat: no-repeat;
	background-size: 50% 50%; 

Мы указываем девять фоновых градиентов, их позиционирование и `background-color`
используя сокращенный вариант записи `background`.

## Сокращенная запись значений свойства `background`

Напомню что отдельные уровни фона указываются по порядку от верхнего до нижнего, 
свойство `background-color` указывается после нижнего уровня. Для фона указывают 
следующие свойства:

	* <background-image> 
	* <background-position> / <background-size> 
	* <background-repeat> 
	* <background-attachment> 
	* <background-origin> 
	* <background-clip>

Если свойство `background-position` не указано, то и `background-size` указывать 
не нужно. Кроме того, так как для `background-origin` и `background-clip` 
используются похожие значения (тоесть такие значения как `border-box` или
`content-box`), если для `background-origin` и`background-clip` значение 
одинаковое, оно указывается только один раз. Остальные свойства (кроме 
`background-image`) могут быть не указаны и в таком случае принимают значение по 
умолчанию.

Так как для всех девяти фоновых слоев, которые мы используем, значения свойств 
`background-repeat` и `background-size` одинаковы и не являются значениями по 
умолчанию, мы указываем их после сокращенной записи `background` чтобы не писать
одно и то же 9 раз.

Есть и еще одна причина прописывать `background-size` отдельно: Safari не 
поддерживает его в сокращенной записи, так же как и версии Firefox до 17-той 
включительно. Кроме того, если в качестве значения для `background-image` указан
градиент, нужно прописывать оба значения `background-size`, если указано только 
одно, результат в разных браузерах будет отличаться (исключением является 
значение 100%, которое впрочем можно не указывать совсем, так как оно является 
значением по умолчанию). 

Для `background-color` задан светло-синий цвет (#43a1cd) и сверху накладываются 
девять неповторяющихся (`background-repeat: no-repeat` для всех) фоновых 
изображений созданных с помощью CSS-градиентов. Размеры всех девяти в два раза 
меньше размеров обьекта (`background-size: 50% 50%`). 

Нижний градиент - тот что выравнен по низу (100%) и отцентрирован по горизонтали 
(50%) - очень простой. Он является переходом от кирпично-красного до того же 
кирпично-красного цвета (`linear-gradient(#ba3e2e, #ba3e2e)`), в результате 
получаем квадрат закрашенный одним цветом.

В остальных восьми слоях осуществляется переход от `transparent` (прозрачности) 
до насыщенного цвета с нулевой прозрачностью или наоборот. Четыре из них 
выглядят как двойной сектор с центральным углом 2*36° = 72°, но половинка 
каждого такого двойного сектора перекрывается другим одинарным сектором с 
центральным углом 36°.

## Несколько слов о линейных градиентах

Чтобы лучше понять как расчитывать угол градиента и процентные значения 
ограничителей цвета, рассмотрим пример кода линейного градиента. Следующее демо  
должно в этом помочь, в нем можно менять угол градиента - просто кликайте по 
точках.

<iframe id="cp_embed_qgoBL" src="http://codepen.io/thebabydino/embed/qgoBL?type=result&amp;height=640&amp;safe=true" 
data-height="640" allowtransparency="true" class="cp_embed_iframe" 
style="width: 100%;border: none; overflow: hidden;" scrolling="no" 
frameborder="0" height="640"></iframe>

*Угол градиента* - это угол между вертикальной осью и линией градиента (синяя 
линия в демо-примере) значение которого определяется по часовой стрелке. Это 
установлено новым синтаксисом который пока не поддерживается браузерами на 
движке WebKit (что [в скором времени изменится](https://bugs.webkit.org/show_bug.cgi?id=67166)). 
Согласно старому синтаксису, углы измеряются по том же принципу что и в 
[тригонометрической единичной окружности](http://en.wikipedia.org/wiki/Unit_circle) 
(против часовой стрелки начиная с горизонтальной оси). 

*Примечание: если отталкиваться от математических знаний, старый подход кажется 
мне более логичным. Однако, новый подход лучше сочитается с другими средствами 
CSS, например с трансформацией вращения, для которого угловые значения 
рассчитываются также по часовой стрелке.*

Это значит что у нас почти всегда разные значения углов в основном синтаксисе и 
в синтаксисе для WebKit. Таким образом, если только мы не используем что-то 
вроде сервиса [-prefix-free](http://leaverou.github.com/prefixfree/) 
(я его использую практически всегда), тогда можно рассчитать значения углов для 
WebKit имея значения углов для остальных движков и наоборот. И кстати это 
довольно легко. Они отсчитываются в противоположные стороны, и значит значение 
угла в одном синтаксисе будет равно значению в другом со знаком минус. У них 
также разница в 90°, рассчитываем мы их так:

	newSyntax = 90° - oldSyntax;
	oldSyntax = 90° - newSyntax;

*Примечание: если угол градиента или сторона в которую производится отсчет не 
указаны (например `linear-gradient(lime, yellow)`), противоположное значение 
угла градиента будет 180°, а не 0°*

У всех точек на [перпендикуляре](http://leaverou.github.com/prefixfree/) к линии 
градиента цвет одинаковый. Перпендикуляр опущеный из вершины квадранта 
противоположного квадранту угла - это линия 0% (линия малинового цвета на 
изображении ниже), его пересечение с линией градиента - это *начальная точка* 
градиента (назовем ее точкой *S*). Перпендикуляр опущеный из противоположной 
вершины (тот, который проходит через квадрант где  находится угол градиента) - 
это линия 100% (черная линия на изображении ниже), ее пересечение с линией 
градиента - это *конечная точка* градиента (назовем ее точкой *E*).

![Gradient with gradient line, 0% line, 100% line](img/gradient.png?raw=true&amp;repo=dig_deep_into_css_gradients "Gradient with gradient line, 0% line, 100% line")

 Чтобы рассчитать процентное значение произвольной точки *P*, для начала опустим
из нее перпендикуляр на линию градиента. Линия градиента и этот перпендикуляр 
 пересекаются в точке которую мы назовем точкой *I*. Теперь рассчитываем 
 соотношение длины отрезков *SI* и *SE*; процентное значение для точки *P* равно 
 этому сооотношению умноженному на 100%. 

## Использование на практике

Попробуем применить все это на примере с разноцветным колесом. 

Сначала рассмотрим градиент который создает одинарный сектор с центральным углом
36°. Это квадратное изображение (см. ниже) с синим сегментом, у которого в 
нижней части один из углов составляет 36°. Проведем горизонтальную и 
вертикальную оси через точку *O* в которой пересекаются диагонали. С этой точки 
опустим перпендикуляр на линию разделяющую темно-синюю часть от прозрачной. 
Получаем линию градиента. Как показано ниже, между вертикальной осью и линией 
градиента лежит угол 36°, и значит угол градиента составляет 36°. 

![Applying the theory for the first slice](img/slice_1.png?raw=true&amp;repo=dig_deep_into_css_gradients "Applying the theory for the first slice")

Теперь опустим перпендикуляр из вершины квадрата в квадранте противоположном 
тому в котором расположен угол градиента. Это линия 0%. Затем опустим 
перпендикуляр из вершины квадрата в квадранте где расположен угол градиента 
(Q I) - это линия 100%.

[Пересечение диагоналей квадрата разделяет каждую из них на две равные части](http://www.mathopenref.com/square.html), 
значит *AO* и *BO* равны. Углы *BOE* и *AOS* равны, так как они являются 
[вертикальными углами](http://www.mathopenref.com/anglesvertical.html). Более 
того, треугольники *BOE* и *AOS* [прямоугольные](www.mathopenref.com/righttriangle.html). 
Эти три утверждения доказывают что треугольники 
[равные](http://en.wikipedia.org/wiki/Triangle#Similarity_and_congruence). Из 
этого в свою очередь следует что *SO* и *EO* равны, и значит длина отрезка *SE* 
равна длине *EO* умноженной на два и длине *SO* умноженной на два. 

![A right angled triangle and how to compute sime and cosine functions](img/right_triangle_trigonometric_functions.png?raw=true&repo=dig_deep_into_css_gradients "A right angled triangle and how to compute sime and cosine functions")

*Примечание: перед тем как двигаться дальше, вспомним несколько 
тригонометрических понятий. Самая длинная сторона прямоугольного треугольника 
лежит напротив прямого угла и называется [гипотенузой](http://www.mathopenref.com/hypotenuse.html). 
Две другие стороны (которые формируют прямой угол) называются 
[катетами](en.wikipedia.org/wiki/Cathetus) прямоугольного треугольника.
[Синус](http://www.mathopenref.com/sine.html) острого угла прямоугольного 
треугольника равен соотношению катета противоположного этому углу и гипотенузы. 
[Косинус](www.mathopenref.com/cosine.html) того же угла равен соотношению
прилежащего катета и гипотенузы.*

Рассчитать длину отрезка *EO* в прямоугольном треугольнике *BOE* очень просто. 
Длину стороны квадрата примем за *a*, тогда длина половины дигонали *BO* равна 
*a\*sqrt(2)/2*. Угол *BOE* равен разнице между углом *BOM*, который равен 45°, и 
углом *EOM*, который равен 36°. Итого угол *BOE* равен 9°. Поскольку *BO* 
является гипотенузой прямоугольного треугольника *BOE*, длина *EO* равна 
*(a\*sqrt(2)/2)\*cos9°*. Значит длина *SE* равна *a\*sqrt(2)\*cos9°*. 

![The BOE triangle](img/slice_1_BOE.png?raw=true&amp;repo=dig_deep_into_css_gradients "The BOE triangle")

Теперь опустим из точки *A* перпендикуляр на линию *PI*. *ASID* прямоугольник, 
значит длина *SI* равна длине *AD*. Рассмотрим прямоугольный треугольник *APD*. 
В нем сторона *AP* - гипотенуза с длиной *a*. Это значит что длина отрезка *AD* 
равна *a\*sin36°*. *SI* равен *AD*, значит его сторона так же равна 
*a\*sin36°*. 

![The APD triangle](img/slice_1_APD.png?raw=true&amp;repo=dig_deep_into_css_gradients "The APD triangle")

Зная длину отрезков *SI* и *SE*, мы можем рассчитать их соотношение. Оно равно 
*sin36°/(sqrt(2)*cos9°) = 0.4234*. Значит % значение ограничителя цвета равно 
42.34%. 

Таким образом мы получили следующее: `linear-gradient(36deg, #272b66 42.34%, 
transparent 42.34%)`

Рассчет процентных значений для остальных фоновых слоев производится точно так 
же.

## Автоматизация рассчетов

Прочитав все вишеизложенное Вы наверное думаете что слишком напряжно проводить 
столько подсчетов. И еще хуже если нужно большее количество градиентов с разными
углами...

Хотя експериментируя с цветовым колесом я и проводила все подсчеты на бумаге... 
Все же я полностью согласна! Именно поэтому я создала простенький инструмент 
который позволяет определить процентное значение для любой точки в окне с 
градиентом. Просто кликните по нужной точке в окне и процентное значение 
появится в его нижней части по центру.

<iframe id="cp_embed_FDbdB" 
src="http://codepen.io/thebabydino/embed/FDbdB?type=result&amp;height=320&amp;safe=true" 
data-height="320" allowtransparency="true" class="cp_embed_iframe" 
style="width: 100%;border: none; overflow: hidden;" scrolling="no" 
frameborder="0" height="320"></iframe>

Размеры окна с градиентом можно менять, так же как и сам градиент. 
Поддерживается новый синтаксис для линейных градиентов, значения углов в 
градусах, значения `to <side>` или же отсутствие указания напрвления градиента.

## Итог

Градиенты CSS являются очень мощным инструментом и понимая как они работают 
можно создавать различные текстуры и фигуры без использования изображений 
которые сложно создать по-другому. 